// Icons for sunrise, sunset, and moonphase taken from the climacons collection
// by Adam Whitcroft (http://adamwhitcroft.com/climacons/)
var sunriseIcon = '<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" version="1.1" id="Layer_1" x="0px" y="0px" width="47.993999" height="35.994999" viewBox="0 0 47.993999 35.994999" enable-background="new 0 0 100 100" xml:space="preserve" sodipodi:docname="Sunrise.svg" inkscape:version="0.92.3 (2405546, 2018-03-11)"><metadata id="metadata13"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><defs id="defs11" /><sodipodi:namedview pagecolor="#ffffff" bordercolor="#666666" borderopacity="1" objecttolerance="10" gridtolerance="10" guidetolerance="10" inkscape:pageopacity="0" inkscape:pageshadow="2" inkscape:window-width="716" inkscape:window-height="480" id="namedview9" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:zoom="2.36" inkscape:cx="23.997" inkscape:cy="17.998" inkscape:window-x="0" inkscape:window-y="0" inkscape:window-maximized="0" inkscape:current-layer="Layer_1" /><g id="g6" transform="translate(-26.003,-32.003)"><g id="g4"><path d="M 38.688,41.859 35.86,39.031 c -0.781,-0.78 -2.047,-0.78 -2.828,0 -0.781,0.781 -0.781,2.047 0,2.828 l 2.828,2.828 c 0.781,0.781 2.047,0.781 2.828,0 0.781,-0.781 0.781,-2.046 0,-2.828 z M 71.997,54 h -3.999 c -1.104,0 -1.999,0.896 -1.999,2 0,1.104 0.895,2 1.999,2 h 3.999 c 1.105,0 2,-0.896 2,-2 0,-1.104 -0.894,-2 -2,-2 z m -39.994,0 h -4 c -1.104,0 -2,0.896 -2,2 0,1.104 0.896,2 2,2 h 4 c 1.104,0 2,-0.896 2,-2 0,-1.104 -0.897,-2 -2,-2 z m 27.996,9.999 H 40.001 c -1.104,0 -1.999,0.896 -1.999,2 0,1.104 0.896,1.999 1.999,1.999 h 19.998 c 1.104,0 2,-0.895 2,-1.999 0,-1.104 -0.895,-2 -2,-2 z m 6.97,-24.968 c -0.78,-0.78 -2.048,-0.78 -2.828,0 l -2.828,2.828 c -0.78,0.781 -0.78,2.047 0,2.828 0.781,0.781 2.048,0.781 2.828,0 l 2.828,-2.828 c 0.78,-0.781 0.78,-2.047 0,-2.828 z m -16.968,0.971 c 1.104,0 1.999,-0.896 1.999,-2 v -3.999 c 0,-1.104 -0.896,-2 -1.999,-2 -1.105,0 -2,0.896 -2,2 v 3.999 c 0,1.104 0.895,2 2,2 z m 0,4 c -6.627,0 -11.999,5.371 -11.999,11.998 0,1.404 0.254,2.747 0.697,3.999 H 43.08 C 42.397,58.822 42.001,57.459 42.001,56 c 0,-4.418 3.582,-7.999 8,-7.999 4.417,0 7.998,3.581 7.998,7.999 0,1.459 -0.396,2.822 -1.078,3.999 h 4.381 c 0.443,-1.252 0.697,-2.595 0.697,-3.999 0,-6.627 -5.372,-11.998 -11.998,-11.998 z m 0,16.247 c 0.552,0 0.999,-0.447 0.999,-1 v -3.827 l 2.536,2.535 c 0.39,0.391 1.023,0.391 1.414,0 0.39,-0.391 0.39,-1.023 0,-1.414 l -4.242,-4.242 c -0.391,-0.391 -1.024,-0.391 -1.414,0 l -4.242,4.242 c -0.391,0.391 -0.391,1.023 0,1.414 0.391,0.391 1.023,0.391 1.414,0 l 2.535,-2.535 v 3.827 c 0,0.553 0.447,1 1,1 z" id="path2" inkscape:connector-curvature="0" style="clip-rule:evenodd;fill-rule:evenodd" /></g></g></svg>';
var sunsetIcon  = '<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" version="1.1" id="Layer_1" x="0px" y="0px" width="47.993999" height="35.994999" viewBox="0 0 47.993999 35.994999" enable-background="new 0 0 100 100" xml:space="preserve" sodipodi:docname="Sunset.svg" inkscape:version="0.92.3 (2405546, 2018-03-11)"><metadata id="metadata9"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><defs id="defs7" /><sodipodi:namedview pagecolor="#ffffff" bordercolor="#666666" borderopacity="1" objecttolerance="10" gridtolerance="10" guidetolerance="10" inkscape:pageopacity="0" inkscape:pageshadow="2" inkscape:window-width="716" inkscape:window-height="480" id="namedview5" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:zoom="2.36" inkscape:cx="23.997" inkscape:cy="17.998" inkscape:window-x="0" inkscape:window-y="0" inkscape:window-maximized="0" inkscape:current-layer="Layer_1" /><path d="m 45.995,25.997 h -4 c -1.104,0 -1.999,-0.896 -1.999,-2 0,-1.104 0.895,-2 1.999,-2 h 4 c 1.104,0 1.999,0.896 1.999,2 0,1.104 -0.894,2 -1.999,2 z M 38.139,12.685 c -0.781,0.781 -2.048,0.781 -2.828,0 -0.781,-0.781 -0.781,-2.047 0,-2.828 l 2.828,-2.828 c 0.78,-0.78 2.047,-0.78 2.827,0 0.781,0.781 0.781,2.047 0,2.828 z m -2.84,15.311 h -4.381 c 0.682,-1.177 1.078,-2.54 1.078,-3.999 0,-4.418 -3.581,-7.999 -7.998,-7.999 -4.418,0 -8,3.581 -8,7.999 0,1.459 0.397,2.822 1.08,3.999 h -4.382 c -0.443,-1.252 -0.697,-2.595 -0.697,-3.999 0,-6.627 5.372,-11.998 11.999,-11.998 6.626,0 11.998,5.371 11.998,11.998 0,1.404 -0.254,2.747 -0.697,3.999 z M 23.998,7.999 c -1.105,0 -2,-0.896 -2,-2 V 2 c 0,-1.104 0.895,-2 2,-2 1.104,0 2,0.896 2,2 v 3.999 c 0,1.104 -0.897,2 -2,2 z M 9.857,12.685 7.029,9.857 c -0.781,-0.781 -0.781,-2.047 0,-2.828 0.781,-0.78 2.047,-0.78 2.828,0 l 2.828,2.828 c 0.781,0.781 0.781,2.047 0,2.828 -0.781,0.781 -2.046,0.781 -2.828,0 z M 8,23.997 c 0,1.104 -0.896,2 -2,2 H 2 c -1.104,0 -2,-0.896 -2,-2 0,-1.104 0.896,-2 2,-2 h 4 c 1.104,0 2,0.896 2,2 z m 15.998,-4 c 0.552,0 1,0.448 1,1 v 3.828 l 2.535,-2.535 c 0.391,-0.391 1.023,-0.391 1.414,0 0.391,0.391 0.391,1.023 0,1.414 l -4.242,4.242 c -0.391,0.391 -1.023,0.391 -1.414,0 l -4.242,-4.242 c -0.391,-0.391 -0.391,-1.023 0,-1.414 0.391,-0.391 1.023,-0.391 1.414,0 l 2.535,2.535 v -3.828 c 0,-0.552 0.447,-1 1,-1 z m -9.999,11.999 h 19.997 c 1.104,0 2,0.896 2,2 0,1.104 -0.896,1.999 -2,1.999 H 13.999 c -1.104,0 -2,-0.895 -2,-1.999 0,-1.104 0.895,-2 2,-2 z" id="path2" inkscape:connector-curvature="0" style="clip-rule:evenodd;fill-rule:evenodd" /></svg>';
var moonIcon = [
  // New Moon
  '<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" version="1.1" id="Layer_1" x="0px" y="0px" width="23.997" height="23.997" viewBox="0 0 23.997 23.997" enable-background="new 0 0 100 100" xml:space="preserve" sodipodi:docname="Moon-New.svg" inkscape:version="0.92.3 (2405546, 2018-03-11)"><metadata id="metadata9"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><defs id="defs7" /><sodipodi:namedview pagecolor="#ffffff" bordercolor="#666666" borderopacity="1" objecttolerance="10" gridtolerance="10" guidetolerance="10" inkscape:pageopacity="0" inkscape:pageshadow="2" inkscape:window-width="716" inkscape:window-height="480" id="namedview5" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:zoom="2.36" inkscape:cx="11.999" inkscape:cy="11.998" inkscape:window-x="0" inkscape:window-y="0" inkscape:window-maximized="0" inkscape:current-layer="Layer_1" /><path d="M 11.999,23.997 C 5.372,23.997 0,18.625 0,11.999 0,5.372 5.372,0 11.999,0 c 6.626,0 11.998,5.372 11.998,11.999 0,6.626 -5.372,11.998 -11.998,11.998 z" id="path2" inkscape:connector-curvature="0" style="clip-rule:evenodd;fill-rule:evenodd" /></svg>',
  // Waxing Crescent
  '<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" version="1.1" id="Layer_1" x="0px" y="0px" width="23.997" height="23.997999" viewBox="0 0 23.997 23.997999" enable-background="new 0 0 100 100" xml:space="preserve" sodipodi:docname="Moon-Waxing-Crescent.svg" inkscape:version="0.92.3 (2405546, 2018-03-11)"><metadata id="metadata9"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><defs id="defs7" /><sodipodi:namedview pagecolor="#ffffff" bordercolor="#666666" borderopacity="1" objecttolerance="10" gridtolerance="10" guidetolerance="10" inkscape:pageopacity="0" inkscape:pageshadow="2" inkscape:window-width="716" inkscape:window-height="480" id="namedview5" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:zoom="2.36" inkscape:cx="11.998" inkscape:cy="11.999" inkscape:window-x="0" inkscape:window-y="0" inkscape:window-maximized="0" inkscape:current-layer="Layer_1" /><path d="M 11.998,23.998 C 18.625,23.998 23.997,18.625 23.997,12 23.997,5.373 18.625,0 11.998,0 5.372,0 0,5.373 0,12 0,18.625 5.372,23.998 11.998,23.998 Z M 9.999,4.262 C 10.639,4.098 11.307,4 11.998,4 c 4.418,0 7.999,3.582 7.999,8 0,4.416 -3.581,7.998 -7.999,7.998 -0.691,0 -1.359,-0.098 -1.999,-0.262 3.448,-0.888 5.999,-4.011 5.999,-7.736 0,-3.727 -2.551,-6.848 -5.999,-7.738 z" id="path2" inkscape:connector-curvature="0" style="clip-rule:evenodd;fill-rule:evenodd" /></svg>',
  // First Quarter
  '<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" version="1.1" id="Layer_1" x="0px" y="0px" width="23.997" height="23.997" viewBox="0 0 23.997 23.997" enable-background="new 0 0 100 100" xml:space="preserve" sodipodi:docname="Moon-First-Quarter.svg" inkscape:version="0.92.3 (2405546, 2018-03-11)"><metadata id="metadata9"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><defs id="defs7" /><sodipodi:namedview pagecolor="#ffffff" bordercolor="#666666" borderopacity="1" objecttolerance="10" gridtolerance="10" guidetolerance="10" inkscape:pageopacity="0" inkscape:pageshadow="2" inkscape:window-width="716" inkscape:window-height="480" id="namedview5" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:zoom="2.36" inkscape:cx="11.998" inkscape:cy="11.998" inkscape:window-x="0" inkscape:window-y="0" inkscape:window-maximized="0" inkscape:current-layer="Layer_1" /><path d="M 11.998,23.997 C 5.371,23.997 0,18.625 0,11.999 0,5.372 5.371,0 11.998,0 c 6.627,0 11.999,5.372 11.999,11.999 0,6.626 -5.372,11.998 -11.999,11.998 z m 0,-3.999 c 4.418,0 7.999,-3.582 7.999,-7.999 C 19.997,7.581 16.416,4 11.998,4 Z" id="path2" inkscape:connector-curvature="0" style="clip-rule:evenodd;fill-rule:evenodd" /></svg>',
  // Waxing Gibbous
  '<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" version="1.1" id="Layer_1" x="0px" y="0px" width="23.996" height="23.997" viewBox="0 0 23.996 23.997" enable-background="new 0 0 100 100" xml:space="preserve" sodipodi:docname="Moon-Waxing-Gibbous.svg" inkscape:version="0.92.3 (2405546, 2018-03-11)"><metadata id="metadata9"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><defs id="defs7" /><sodipodi:namedview pagecolor="#ffffff" bordercolor="#666666" borderopacity="1" objecttolerance="10" gridtolerance="10" guidetolerance="10" inkscape:pageopacity="0" inkscape:pageshadow="2" inkscape:window-width="716" inkscape:window-height="480" id="namedview5" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:zoom="2.36" inkscape:cx="11.998" inkscape:cy="11.998" inkscape:window-x="0" inkscape:window-y="0" inkscape:window-maximized="0" inkscape:current-layer="Layer_1" /><path d="M 11.998,23.997 C 5.371,23.997 0,18.625 0,11.998 0,5.372 5.371,0 11.998,0 c 6.627,0 11.998,5.372 11.998,11.998 0,6.627 -5.371,11.999 -11.998,11.999 z M 11.998,4 c -2.209,0 -4,3.581 -4,7.998 0,4.418 1.791,7.999 4,7.999 4.418,0 7.999,-3.581 7.999,-7.999 C 19.997,7.581 16.416,4 11.998,4 Z" id="path2" inkscape:connector-curvature="0" style="clip-rule:evenodd;fill-rule:evenodd" /></svg>',
  // Full Moon
  '<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" version="1.1" id="Layer_1" x="0px" y="0px" width="23.997999" height="23.997" viewBox="0 0 23.997999 23.997" enable-background="new 0 0 100 100" xml:space="preserve" sodipodi:docname="Moon-Full.svg" inkscape:version="0.92.3 (2405546, 2018-03-11)"><metadata id="metadata9"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><defs id="defs7" /><sodipodi:namedview pagecolor="#ffffff" bordercolor="#666666" borderopacity="1" objecttolerance="10" gridtolerance="10" guidetolerance="10" inkscape:pageopacity="0" inkscape:pageshadow="2" inkscape:window-width="716" inkscape:window-height="480" id="namedview5" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:zoom="2.36" inkscape:cx="12" inkscape:cy="11.998" inkscape:window-x="0" inkscape:window-y="0" inkscape:window-maximized="0" inkscape:current-layer="Layer_1" /><path d="M 12,23.997 C 5.373,23.997 0,18.625 0,11.998 0,5.372 5.373,0 12,0 18.627,0 23.998,5.372 23.998,11.998 23.998,18.625 18.627,23.997 12,23.997 Z M 12,4 c -4.418,0 -8,3.581 -8,7.998 0,4.418 3.582,7.999 8,7.999 4.418,0 7.998,-3.581 7.998,-7.999 C 19.998,7.581 16.418,4 12,4 Z" id="path2" inkscape:connector-curvature="0" style="clip-rule:evenodd;fill-rule:evenodd" /></svg>',
  // Waning Gibbous
  '<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" version="1.1" id="Layer_1" x="0px" y="0px" width="23.997999" height="23.997" viewBox="0 0 23.997999 23.997" enable-background="new 0 0 100 100" xml:space="preserve" sodipodi:docname="Moon-Waning-Gibbous.svg" inkscape:version="0.92.3 (2405546, 2018-03-11)"><metadata id="metadata9"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><defs id="defs7" /><sodipodi:namedview pagecolor="#ffffff" bordercolor="#666666" borderopacity="1" objecttolerance="10" gridtolerance="10" guidetolerance="10" inkscape:pageopacity="0" inkscape:pageshadow="2" inkscape:window-width="716" inkscape:window-height="480" id="namedview5" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:zoom="2.36" inkscape:cx="12" inkscape:cy="11.998" inkscape:window-x="0" inkscape:window-y="0" inkscape:window-maximized="0" inkscape:current-layer="Layer_1" /><path d="m 12,23.997 c 6.625,0 11.998,-5.371 11.998,-11.998 C 23.998,5.372 18.625,0 12,0 5.373,0 0,5.372 0,11.999 0,18.626 5.373,23.997 12,23.997 Z M 12,4.001 c 2.209,0 3.998,3.58 3.998,7.998 0,4.418 -1.789,7.998 -3.998,7.998 -4.418,0 -8,-3.58 -8,-7.998 0,-4.418 3.582,-7.998 8,-7.998 z" id="path2" inkscape:connector-curvature="0" style="clip-rule:evenodd;fill-rule:evenodd" /></svg>',
  // Last Quarter
  '<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" version="1.1" id="Layer_1" x="0px" y="0px" width="23.997999" height="23.997" viewBox="0 0 23.997999 23.997" enable-background="new 0 0 100 100" xml:space="preserve" sodipodi:docname="Moon-Last-Quarter.svg" inkscape:version="0.92.3 (2405546, 2018-03-11)"><metadata id="metadata9"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><defs id="defs7" /><sodipodi:namedview pagecolor="#ffffff" bordercolor="#666666" borderopacity="1" objecttolerance="10" gridtolerance="10" guidetolerance="10" inkscape:pageopacity="0" inkscape:pageshadow="2" inkscape:window-width="716" inkscape:window-height="480" id="namedview5" showgrid="false" showborder="true" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:zoom="2.36" inkscape:cx="12" inkscape:cy="11.998" inkscape:window-x="0" inkscape:window-y="0" inkscape:window-maximized="0" inkscape:current-layer="Layer_1" /><path d="m 12,23.997 c 6.625,0 11.998,-5.371 11.998,-11.999 C 23.998,5.372 18.625,0 12,0 5.373,0 0,5.372 0,11.998 0,18.626 5.373,23.997 12,23.997 Z m 0,-4 c -4.418,0 -8,-3.58 -8,-7.999 C 4,7.581 7.582,4 12,4 Z" id="path2" inkscape:connector-curvature="0" style="clip-rule:evenodd;fill-rule:evenodd" /></svg>',
  // Waning Crescent
  '<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" version="1.1" id="Layer_1" x="0px" y="0px" width="23.997999" height="23.997" viewBox="0 0 23.997999 23.997" enable-background="new 0 0 100 100" xml:space="preserve" sodipodi:docname="Moon-Waning-Crescent.svg" inkscape:version="0.92.3 (2405546, 2018-03-11)"><metadata id="metadata9"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><defs id="defs7" /><sodipodi:namedview pagecolor="#ffffff" bordercolor="#666666" borderopacity="1" objecttolerance="10" gridtolerance="10" guidetolerance="10" inkscape:pageopacity="0" inkscape:pageshadow="2" inkscape:window-width="716" inkscape:window-height="480" id="namedview5" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:zoom="2.36" inkscape:cx="11.999" inkscape:cy="11.998" inkscape:window-x="0" inkscape:window-y="0" inkscape:window-maximized="0" inkscape:current-layer="Layer_1" /><path d="M 11.999,23.997 C 5.373,23.997 0,18.626 0,11.999 0,5.372 5.373,0 11.999,0 c 6.627,0 11.999,5.372 11.999,11.999 0,6.627 -5.372,11.998 -11.999,11.998 z m 2,-19.734 C 13.358,4.097 12.691,4.001 11.999,4.001 7.582,4.001 4,7.581 4,11.999 c 0,4.418 3.582,7.998 7.999,7.998 0.692,0 1.359,-0.096 2,-0.262 C 10.551,18.846 8,15.725 8,11.999 8,8.273 10.551,5.151 13.999,4.263 Z" id="path2" inkscape:connector-curvature="0" style="clip-rule:evenodd;fill-rule:evenodd" /></svg>'
];

function loadWeather(){
  $.getJSON("weather.php", displayWeather);
}

function displayWeather(data){
  var dailyskycons = new Skycons({"color": "grey"});
  var currentskycons = new Skycons({"color": "darkgrey"});
  $("#weather").empty();
  $("#weather").append("<div id='current'></div>")
  $("#current").append(`<div class='currentSummary'>${data.current.summary}</div>`); 
  $("#current").append(`<div class='currentTemperature'>${data.current.temperature}&#176;</div>`);
  $("#current").append("<div class='currentPop'>" + Math.round(data.current.pop * 100) + "%</div>");
  $("#current").append(`<div class='currentIcon'><canvas id="current-icon" width="96" height="96"></div>`);
  $("#current").append("<div class= 'currentWind'>" + data.current.windSpeed + "mph - " + direction(data.current.windBearing) + "</div>");
  currentskycons.add('current-icon', chooseIcon(data.current.icon));

  if(data.current.alert){
    $("#current").append("<div class='alert'>!</div>");
  }

  $("#weather").append('<div id="week"></div>');
  $("#week").append(`<div class='weekSummary'>${data.daily.summary}</div>`);
  for(let day in data.daily.data){
    $("#week").append(`<div class='day' id='${day}' >`);
    $(`#${day}`).append(`<div class='dayName'>${day}</div>`);
    $(`#${day}`).append("<div class='dayContainer'></div>");
    $(`#${day} > .dayContainer`).append(`<div class='dailyLow'>${data.daily.data[day].low}&#176;</div>`);
    $(`#${day} > .dayContainer`).append(`<div class='dailyHigh'>${data.daily.data[day].high}&#176;</div>`);
    $(`#${day} > .dayContainer`).append("<div class='dailyPop'>" + Math.round(data.daily.data[day].pop * 100) + "%</div>");
    $(`#${day} > .dayContainer`).append(`<div class='dailyIcon'><canvas id="icon-${day}" width="48" height="48"></canvas></div>`);

    dailyskycons.add(`icon-${day}`, chooseIcon(data.daily.data[day].icon));
  }

  $("#week").append('<div class="day" id="almanac"></div>');
  $("#almanac").append('<div class="dayName">Almanac</div>');
  $("#almanac").append("<div class='dayContainer'></div>");
  $("#almanac > .dayContainer").append(`<div class="sunrise">${sunriseIcon}${data.almanac.sunrise}</div>`);
  $("#almanac > .dayContainer").append(`<div class="sunset">${sunsetIcon}${data.almanac.sunset}</div>`);
  // Math here converts from decimal moonphase 0=new 0.5 = full to one of the 8 icons in the array above
  $("#almanac > .dayContainer").append(`<div class="moonphase">${moonIcon[Math.round((data.almanac.moonphase*8)%8)]}</div>`);

  //Make the animated icons start animating
  currentskycons.play();
  dailyskycons.play();
}

function chooseIcon(icon){
  let skycon = Skycons.CLEAR_DAY;
  switch(icon){
    case "clear-day": skycon = Skycons.CLEAR_DAY; break;
    case "clear-night": skycon = Skycons.CLEAR_NIGHT; break;
    case "rain": skycon = Skycons.RAIN; break;
    case "snow": skycon = Skycons.SNOW; break;
    case "sleet": skycon = Skycons.SLEET; break;
    case "wind": skycon = Skycons.WIND; break;
    case "fog":skycon = Skycons.FOG; break;
    case "cloudy": skycon = Skycons.CLOUDY; break;
    case "partly-cloudy-day": skycon = Skycons.PARTLY_CLOUDY_DAY; break;
    case "partly-cloudy-night": skycon = Skycons.PARTLY_CLOUDY_NIGHT; break;
  }
  return skycon;
}

// No error checking on the input. It is the responsiblity
// of the caller to provide a bearing from 0 to 360.
// Data provided from darksky is always an integer 0 to 359.
function direction(bearing){
  var ret;
  if ((22 < bearing) && (bearing <= 67))
    ret = "NE";
  else if ((67 < bearing) && (bearing <= 112))
    ret = "E";
  else if ((112 < bearing) && (bearing <= 157))
    ret = "SE";
  else if ((157 < bearing) && (bearing <= 202))
    ret = "S";
  else if ((202 < bearing) && (bearing <= 247))
    ret = "SW";
  else if ((247 < bearing) && (bearing <= 292))
    ret = "W";
  else if ((292 < bearing) && (bearing <= 337))
    ret = "NW";
  else ret = "N"; // 337-360/0-22

  return ret;
}
